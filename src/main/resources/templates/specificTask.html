<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org/" xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
    <meta charset="utf-8">
    <link rel="shortcut icon" href="#">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
     <script src="/js/specificTask.js" type="text/javascript"></script>
    <script src="/js/urlTemplates.js" type="text/javascript"></script>
    <link href="/css/task.css" rel="stylesheet">
</head>
<body th:onload="'calledOnLoad(\''+ ${task.id} +'\');'">
<header th:insert="blocks/header :: header"></header>
    <div class="body" >
        <div class="task_form" th:object="${task}">
            <div class="form-group">
                <img class="card-img-top" th:src="*{'data:image/jpg;image/png;base64,'+taskImage}" id="taskImage" width="500" alt=""/>
            </div>
            <div class="form-group">
                <label>Название проблемы</label>
                <input type="text" class="form-control" th:value="${task.taskName}" readonly>
            </div>
            <div class="form-group">
                <label>Описание</label>
                <textarea class="form-control"rows="3"th:field="${task.taskDescription}" readonly></textarea>

            </div>
            <div class="form-group">
                <label>Адрес</label>
                <input class="form-control" type="text"th:value="${task.taskLocation}" readonly>
            </div>
            <div class="form-group">
                <label>Ответственный</label>
                <input class="form-control" type="text"th:value="${task.responsible}" readonly>
            </div>
            <div class="form-group">
                <label>Соц работник</label>
                <input class="form-control" type="text"th:value="${task.socWorker}" readonly>
            </div>
            <div class="form-group">
                <label>Приоритет</label>
                <input class="form-control" type="text"th:value="${task.priority}" readonly>
            </div>
            <div class="form-group">
                <label>Статус выполнения</label>
                <input class="form-control" type="text"th:value="${task.taskStatus}" readonly>
            </div>
            <div class="form-group">
                <label>Дата регистрации</label>
                <input class="form-control" type="text"th:value="${task.regDate.split(' ')[0]}" readonly>
            </div>
            <div class="form-group">
                <label>Отзыв</label>
                <input class="form-control" type="text"th:value="${task.feedBack}" readonly>
            </div>
            <div class="mb-4">
                <a th:href="${urls + '/' + task.id}"class="btn btn-primary" th:if="${isEditAuthor}!=null">Редактировать</a>
                <a href="#" class="btn btn-primary" th:if="${isEditResponsible}!=null">Редактировать</a>
                <a href="#" class="btn btn-primary" th:if="${isFeedback}!=null">Оставить отзыв</a>
            </div>
            <p th:if="${task.commentAllow}==false">Комментарии отключены</p>
            <div th:if="${task.commentAllow}==true" id="comment-box">
                <h4>Всего комментариев:</h4>
                <div class="comment mb-4" th:if="${commentPermission}!=null">
                    <img th:src="${task.getAuthor().getUserImage()}" class="comment-author-img">
                    <div style="display: inline-block;margin-left: 10px;">
                        <span th:text="${#authentication.getPrincipal().getFirstname()}"/>
                        <textarea class="form-control" style="width: 675px;" id="comment-text" placeholder="Оставьте комментарий"></textarea>
                    </div>
                    <hr>
                    <button type="button" class="btn btn-outline-danger" onclick="cancelCommentBtn()">Отмена</button>
                    <button type="button" class="btn btn-outline-success" th:onclick="'postComment(\''+ ${task.id} +'\');calledOnLoad(\''+ ${task.id} +'\')'" >Оставить комментарий</button>
                </div>
                <div id="printComments" style="max-height: 500px;overflow: auto;">

                </div>
            </div>
        </div>
    </div>
<footer th:insert="blocks/footer :: footer"></footer>
</body>
</html>
